#!/usr/bin/env ruby
$board_row_1 = ' 1 | 2 | 3 '
$board_row_2 = ' 4 | 5 | 6 '
$board_row_3 = ' 7 | 8 | 9 '
$exit = false
$win = false
$turns = 9

p 'How to play:'
p 'Tic tac toe is a game for two players who will take turns to mark the spaces of a 3x3 grid, the first player who place three of their marks in a horizontal, vertical, or diagonal row wins'
p 'To play with this program, first enter a name for each of the players, when you are ready type the number where you want to put your mark and hit enter. The game will let you know when is your turn'

p 'Enter a name for player 1:'
$player_1 = gets.chomp
p 'Enter a name for player 2:'
$player_2 = gets.chomp
while $player_1 == $player_2
  p "Use a diferent name for player 2"
  $player_2 = gets.chomp
end

def display_board
  p $board_row_1
  p $board_row_2
  p $board_row_3
end

def have_won
  $win = true if $board_row_1 == ' X | X | X ' or $board_row_1 == ' O | O | O '
  $win = true if $board_row_2 == ' X | X | X ' or $board_row_2 == ' O | O | O '
  $win = true if $board_row_3 == ' X | X | X ' or $board_row_3 == ' O | O | O '
  $win = true if $board_row_1[1] == 'X' and $board_row_2[1] == 'X' and $board_row_3[1] == 'X'
  $win = true if $board_row_1[1] == 'O' and $board_row_2[1] == 'O' and $board_row_3[1] == 'O'
  $win = true if $board_row_1[5] == 'X' and $board_row_2[5] == 'X' and $board_row_3[5] == 'X'
  $win = true if $board_row_1[5] == 'O' and $board_row_2[5] == 'O' and $board_row_3[5] == 'O'
  $win = true if $board_row_1[9] == 'X' and $board_row_2[9] == 'X' and $board_row_3[9] == 'X'
  $win = true if $board_row_1[9] == 'O' and $board_row_2[9] == 'O' and $board_row_3[9] == 'O'
  $win = true if $board_row_1[1] == 'X' and $board_row_2[5] == 'X' and $board_row_3[9] == 'X'
  $win = true if $board_row_1[1] == 'O' and $board_row_2[5] == 'O' and $board_row_3[9] == 'O'
  $win = true if $board_row_1[9] == 'X' and $board_row_2[5] == 'X' and $board_row_3[1] == 'X'
  $win = true if $board_row_1[9] == 'O' and $board_row_2[5] == 'O' and $board_row_3[1] == 'O'
  $exit = true if $turns == 0 || $win
end

class Player_move
  @count = 0
  def self.board_check
    turn = 'X' if @count.even?
    turn = 'O' if @count.odd?
    player_mark = gets.chomp
    @valid_turn = false
    $board_row_1.length.times do |n|
      if player_mark == $board_row_1[n] and player_mark != "|" and player_mark != " " and player_mark  != 'X' and player_mark != 'O'
        $board_row_1[n] = turn
        @valid_turn = true
      end
    end
    $board_row_2.length.times do |n|
      if player_mark == $board_row_2[n] and player_mark != "|" and player_mark != " " and player_mark  != 'X' and player_mark != 'O'
        $board_row_2[n] = turn
        @valid_turn = true
      end
    end
    $board_row_3.length.times do |n|
      if player_mark == $board_row_3[n] and player_mark != "|" and player_mark != " " and player_mark  != 'X' and player_mark != 'O'
        $board_row_3[n] = turn
        @valid_turn = true
      end
    end
    @count += 1 if @valid_turn
    $turns += 1 unless @valid_turn
    return puts "Please enter a valid character" unless @valid_turn
  end

  def self.make_a_move
    have_won
    @count -= 1 if $win
    current_player = $player_1 if @count.even?
    current_player = $player_2 if @count.odd?
    p "It's #{current_player}'s turn!" unless $win
    display_board
    return p "Its a draw" if $turns == 0 and $win == false
    return p "#{current_player} won!" if $win
    p 'Make your move:'
    Player_move.board_check
    $turns -= 1
  end
end

Player_move.make_a_move while $exit == false
